### Režim čítače/časovače

- čítač / časovač = registr
- obsah lze číst i zapisovat
- obsahuje řídící vstupy
	- **count** - inkrementace
	- **clear** - vymazání obsahu
	- **direction** - nepovinný, pokud je čítač up / down (určuje jeho směr)
- využití čítače / časovače
	- časové zpoždění po startu oscilátoru
	- časové zpoždění po zapnutí mcu

#### Čítač vs Časovač

- **Čítač**
	- připojen na externí pin (hodinový signál **nemusí** být periodický)
![[Pasted image 20230215083209.png]]

- **Časovač**
	- připojen přes předdělič na frekvenci instrukčního cyklu
![[Pasted image 20230215083328.png]]
	- hodinový signál **je** periodický (a známe jeho frekvenci)

### Podrobný popis pro ATmega64

![[Pasted image 20230215083138.png]]

![[Pasted image 20230215083416.png]]

- *nahoře* čítače / časovače
- řídící logika čítače / časovače
- výběr cyklu
	- externí
	- frekvence instrukčního cyklu
- další části (*uprostřed*) pouze vylepšují vlastnosti čítače / časovače - rozšířené funkce
- *dole* jsou řídící registry

### Rozšířené funkce

#### COMPARE

- časovač doplněn komparátorem a porovnávacím registrem
	- když se shoduje porovnávací registr a časovač => lze generovat daný signál na výstupním pinu 
- náběžná hrana / sestupná hrana / negace hodnoty
- u Atmega64 jsou 3 komparátory
- **Hardwarové zkrácení rozsahu**
	- compare v případě určité (nastavené) hodnoty vyšle signál na pin "TOP" => vynuluje čítač => čítá se znovu od nuly
	- výhodnějšíš než softwarové řešení

#### CAPTURE

- obrácená funkce než compare
- pro zjištění **přesného** času určité události
	- když přijde vstup => obsah časovače se uloží do záchytného registru
		- lze k němu zpětně přistupovat
	- pokud bychom řešili softwarově může dojít ke zpoždění
		- hardware je v tomhle přesný

#### PWM (pulzně šířková modulace)

- režim compare, kde lze nastavit délku periody a šířku pulzu
	- poměr šířky pulzu a šířky mezery se nazývá střída
- zmožňuje plynulou změnu výkonu na zátěži (počet otáček motoru, svítivost LED diody atd)
- pro generování PWM signálu u ATmega64 je nutno použít části Compare a Capture
	- pouze tři výstupy pro PWM signál => PB1, PB2, PB3

### Dohlížecí časovač WDT

- watchdog timer
- časovač, který má nezávislý vstup hodinového signálu
	- když přeteče, mcu se resetuje
- uvádí se, co bylo důvodem restartu
	- mcu na to může reagovat
- slouží jako ochrana před chybami

![[Pasted image 20230215082806.png]]

